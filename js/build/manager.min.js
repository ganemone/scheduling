function renderCalendar(a,b,c){$("#calendar").fullCalendar("destroy"),$("#calendar").css("width",$(document).width()-200);var d={header:{left:"prev,next",center:"title",right:"month,basicWeek,agendaDay"},allowCalEventOverlap:!1,selectable:!0,slotMinutes:a,minTime:6,maxTime:21,editable:!0,resizeable:!0,droppable:!0,defaultView:"month",snapMinutes:15,timeFormat:"h:mm{ - h:mm}",dropAccept:".external-event, .fc-event",viewDisplay:function(a){initializeGoalTips(a),h="month"==a.name?0/0:6e3,$("span.fc-header-title h2").hide(),"agendaDay"==a.name,$("#calendar").fullCalendar("option","contentHeight",h)},drop:function(a){$(".fc-event").qtip("hide");var b=$(this).data("eventObject"),c=b.days,d=b.starts,e=b.ends,f=b.categories,g=new Date(a.getFullYear(),a.getMonth(),a.getDate()-a.getDay()),h=new Date(g.getFullYear(),g.getMonth(),g.getDate()+6),i={state0:{title:"Schedule Using Template",html:makeTemplateForm(g,h,"checkbox")+"</table>",submit:function(a,b,h,i){for(var j in i)for(var k=0;k<i[j].length;k++){var l=i[j];if("NA"==l)break;for(var m=0;m<c.length;m++){var n=new Date;n.setFullYear(g.getFullYear()),n.setMonth(g.getMonth()),n.setDate(g.getDate()+Number(c[m][0])),$.ajax({type:"POST",data:{employeeId:l,day:n.toDateString(),begin:d[m],end:e[m],category:f[m]},url:url+"index.php/manager/scheduleEmployee",success:function(){$("#calendar").fullCalendar("refetchEvents")},error:function(a){alert(a+"/manager/scheduleEmployee")}})}}}}};$.prompt(i)},loading:function(a){a?$("#loading").show():$("#loading").fadeOut()},eventRender:function(a,b){"scheduled"==a.category&&b.bind("contextmenu",function(c){$("input.rightClickMenuItem").each(function(){$(this).val()==a.area?$(this).attr("checked","checked"):$(this).removeAttr("checked"),$(this).data("element",b),$(this).data("event",a)}),$("#sflRightClickItem").data("element",b).data("event",a),1==a.sfl?$("#sflRightClickItem").attr("checked","checked"):$("#sflRightClickItem").removeAttr("checked"),$("#editEventPopup").show().offset({top:c.pageY,left:c.pageX}),c.preventDefault()}),("Available"==a.category||"Busy"==a.category||"Custom"==a.category)&&b.bind("contextmenu",function(c){$(".overrideRightClick").each(function(){$(this).val()==a.category?$(this).attr("checked","checked"):$(this).removeAttr("checked"),$(this).data("element",b),$(this).data("event",a)}),$("#overrideAvailability").show().offset({top:c.pageY,left:c.pageX}),c.preventDefault()});var c="";"scheduled"==a.category?null!=a.start&&null!=a.end&&(c=a.title+" "+timeToString(a.start)+"-"+timeToString(a.end)):c="Custom"==a.category?a.title:"events"==a.category?a.title+" At "+a.location:a.title+" "+a.category,b.qtip({content:c,position:{at:"top center",my:"bottom center"},style:{tip:"bottomMiddle",classes:"qtip-dark"},show:{event:"click"},events:{render:function(a,b){b.elements.tooltip.click(b.hide)}}})},eventClick:function(a,b){$("#editEventPopup").hide(),$("#employeeRightClickDiv").hide(),$("#overrideAvailability").hide();var c=!1;$("#deleteOption").is(":checked")&&(c=!0),"scheduled"!=a.category&&b.shiftKey&&("emptyShifts"==a.category?fillEmptyShift(a):"Busy"!=a.category&&scheduleShiftClick(a)),("scheduled"==a.category||"events"==a.category||"emptyShifts"==a.category)&&(b.shiftKey&&"scheduled"==a.category?promptEmployeeHPW(a):1!=c||b.shiftKey||($("#deleteConfirmation").dialog({autoOpen:!1,modal:!0,position:["middle",100],buttons:{Delete:function(){deleteEvent(a.category,a.rowId,a.id),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}),$("#deleteConfirmation").dialog("open")))},eventDragStart:function(){$(".fc-event").qtip("hide")},eventDragStop:function(){$(".fc-event").qtip("hide")},eventDrop:function(a,b,c,d,e){$(".fc-event").qtip("hide"),eventMove(a,b,c,e,"dragged")},eventResize:function(a,b,c,d){eventMove(a,b,c,d,"resized")},select:function(a,b,c,d){if($("#editEventPopup").hide(),$("#employeeRightClickDiv").hide(),$("#overrideAvailability").hide(),c)return calendar.fullCalendar("gotoDate",a),calendar.fullCalendar("changeView","agendaDay"),!0;if(!d.shiftKey){if(1==tutorial)return!0;calendar.fullCalendar("getView").name;var e=a.getHours(),f=b.getHours(),g=a.toTimeString().split(" ")[0].split(":")[1],h=b.toTimeString().split(" ")[0].split(":")[1];e>12?(e-=12,startTime=e+":"+g+"pm"):startTime=e+":"+g+"am",f>12?(f-=12,endTime=f+":"+h+"pm"):endTime=f+":"+h+"am",scheduleEmployee(a,b,startTime,endTime),calendar.fullCalendar("unselect")}},eventSources:[{url:url+"index.php/manager/eventSource",data:{busy:busy,removedEmployees:removedEmployees},error:function(a,b){alert(b+"/manager/eventSource")}},{url:url+"index.php/manager/scheduledEventSource",error:function(a,b){alert(b+"/manager/scheduledEventSource")}},{url:url+"index.php/manager/coEventSource",error:function(a,b){alert(b+"coEventSource")}}]};calendar=$("#calendar").fullCalendar(d),calendar.fullCalendar("gotoDate",c),calendar.fullCalendar("changeView",b)}function setTutorial(a){tutorial=a}function toggleEvents(a){var b=!1,c=document.getElementById(a).style.color;"Black"==c||"black"==c?(document.getElementById(a).style.color="Green",b=!0):(document.getElementById(a).style.color="Black",$("#calendar").fullCalendar("removeEvents",function(b){return b.employeeId==a?!0:void 0}),b=!1),$.ajax({type:"POST",data:{employeeId:a,display:b},url:url+"index.php/manager/toggleDisplay",success:function(){$("#calendar").fullCalendar("refetchEvents")},error:function(a,b){alert(b+"toggleDisplay")}})}function selectHidden(){$("#hiddenRadio").attr("checked","true")}function initSelectMenu(){$("#firstOption").attr("selected","true")}function stringToTime(a){var b=a.split(":"),c=b[1].split(" ");return hour=Number(b[0]),"pm"==c[1]&&(hour+=12),new Date(0,0,0,hour,c[0],0).toTimeString().split(" ")[0]}function timeToString(a){var b=a.toTimeString().split(" ")[0].split(":"),c="am",d=Number(b[0]);if(Number(b[0])>12){var c="pm";d-=12}return d+":"+b[1]+" "+c}function deleteTemplate(a){$("#deleteOption").is(":checked")&&$("#deleteConfirmation").dialog({autoOpen:!0,position:["middle",100],buttons:{Delete:function(){$(this).dialog("close"),$.ajax({type:"POST",url:url+"index.php/manager/deleteTemplate",data:{templateId:$(a).data("eventObject").templateId},success:function(){$(a).qtip("hide").remove()},error:function(a){alert(a+"deleteTemplate")}})},Cancel:function(){$(this).dialog("close")}}})}function showGoal(a,b){var c;"month"==b.name?(a.setDate(1),c=new Date(a.getFullYear(),a.getMonth()+1,0)):"basicWeek"==b.name?(a.setDate(a.getDate()-a.getDay()),c=new Date(a.getFullYear(),a.getMonth(),a.getDate()+6)):c=a,$.ajax({type:"GET",url:url+"index.php/manager/getGoal",data:{startDate:a.toDateString(),endDate:c.toDateString()},success:function(){},error:function(a,b,c){alert(c+"getGoal")}})}function getStartAndEndDates(a,b){var c="";if("agendaWeek"==a||"basicWeek"==a){var d=new Date(b.getFullYear(),b.getMonth(),b.getDate()-b.getDay()),e=new Date(d.getFullYear(),d.getMonth(),d.getDate()+6);c={startDate:d,endDate:e}}else if("month"==a){var d=new Date(b.getFullYear(),b.getMonth(),1),e=new Date(d.getFullYear(),d.getMonth()+1,0);c={startDate:d,endDate:e}}else("agendaDay"==a||"basicDay"==a)&&(c={startDate:b,endDate:b});return c}function initializeGoalTips(a){var b=getStartAndEndDates(a.name,$("#calendar").fullCalendar("getDate"));"agendaWeek"==a.name||"basicWeek"==a.name?$.ajax({type:"GET",url:url+"index.php/manager/getGoal",data:{startDate:b.startDate.toDateString(),endDate:b.endDate.toDateString()},success:function(a){var b=a,c=$("span.fc-header-title h2").text(),d=c.split("(");$("span.fc-header-title h2").text(d[0]+" ($"+b+")"),$("span.fc-header-title h2").fadeIn()},error:function(a,b,c){alert(c+"getGoal")}}):$.ajax({type:"GET",url:url+"index.php/manager/getGoal",data:{startDate:b.startDate.toDateString(),endDate:b.endDate.toDateString()},success:function(a){var b=$("span.fc-header-title h2").text(),c=b.split("(");$("span.fc-header-title h2").text(c[0]+" ($"+a+")"),$("span.fc-header-title h2").fadeIn()},error:function(a,b,c){alert(c+"getGoal")}})}function eventMove(a,b,c,d,e){var f=a.title;if("Test Schedule"==f)return!0;if("scheduled"!=a.category)d();else{var g=a.employeeId;new Date(a.start.getFullYear(),a.start.getMonth(),a.start.getDate()-b);var h=a.start,i=a.start.toTimeString(),j=a.end.toTimeString();$.ajax({type:"POST",url:url+"index.php/manager/deleteEvent",data:{id:a.rowId,table:"scheduled"},success:function(){$.ajax({type:"POST",url:url+"index.php/manager/scheduleEmployee",data:{employeeId:g,day:h.toDateString(),begin:i.split(" ")[0],end:j.split(" ")[0],category:a.area,sfl:a.sfl},success:function(a){var b=jQuery.parseJSON(a),c=b[1];1==c&&$("#calendar").fullCalendar("refetchEvents")},error:function(){alert("Error: scheduleEmployee")}})},error:function(){alert("Error: deleteEvent")}})}var k={start:new Date(a.start.getFullYear(),a.start.getMonth(),a.start.getDate(),a.start.getHours(),a.start.getMinutes()-c),end:new Date(a.end.getFullYear(),a.end.getMonth(),a.end.getDate(),a.end.getHours(),a.end.getMinutes()-c),category:a.category,event:a.category};"resized"==e&&(k={start:new Date(a.start.getFullYear(),a.start.getMonth(),a.start.getDate(),a.start.getHours(),a.start.getMinutes()),end:new Date(a.end.getFullYear(),a.end.getMonth(),a.end.getDate(),a.end.getHours(),a.end.getMinutes()-c),category:a.category,event:a.category})}function createTemplate(a,b){var c=$("#calendar").fullCalendar("getDate"),d="object"==typeof a?a[0]:a;c.setDate(c.getDate()-c.getDay()),$.ajax({type:"POST",url:url+"index.php/manager/makeTemplate",data:{id:d,title:b,date:c.toDateString()},success:function(){loadTemplates()},error:function(){alert("ERROR makeTemplate")}})}function getEmployeesAvailable(a,b){var c=[],d=$("#calendar").fullCalendar("clientEvents",function(d){return startDate=new Date(d.start.getFullYear(),d.start.getMonth(),d.start.getDate()),beginDate=new Date(a.getFullYear(),a.getMonth(),a.getDate()),endDate=new Date(b.getFullYear(),b.getMonth(),b.getDate()),startDate>=beginDate&&endDate>=startDate&&("Available"==d.category||"Custom"==d.category)&&-1==$.inArray(d.employeeId,c)?(c.push(d.employeeId),!0):!1});return d}function loadTemplates(){var a="";$(".external-event").each(function(){$(this).remove()}),$.ajax({type:"GET",url:url+"index.php/manager/loadTemplates",success:function(b){for(var c=jQuery.parseJSON(b),d=0;d<c.length;d++){var e=jQuery.parseJSON(c[d]),f="#template"+d;a="<div class='external-event' id='template"+d+"' title='"+e.description+"' onclick=deleteTemplate('"+f+"');>"+e.templateName+"</div>",$("#external-events").append(a),$("#template"+d).qtip({content:e.description,position:{my:"bottom left",at:"top right"},style:{tip:"bottomLeft",classes:"qtip-dark"},show:{event:"click"},events:{render:function(a,b){b.elements.tooltip.click(b.hide)}}}),$("#template"+d).data("eventObject",e),$("#template"+d).draggable({zIndex:999,revert:!0,revertDuration:0,scroll:!1,start:function(){$("div.fc-event").qtip("disable"),$("div.external-event").qtip("hide"),$("div.external-event").qtip("disable")},stop:function(){$("div.fc-event").qtip("enable"),$("div.external-event").qtip("enable")}})}},error:function(a){alert(a+"loadTemplates")}})}function makeForm(a,b,c,d,e){e="undefined"==typeof e?!1:e,d="undefined"!=typeof d?d:!0;for(var f="group",g="<table>",h=getEmployeesAvailable(a,b),i=0;i<h.length;i+=2){var j="group";"checkbox"==c&&(j=i);var f=h[i].title.split(" "),f=f[0]+" "+f[1];if(0!=e){var k=e[h[i].employeeId].desired.split("-")[1],l=e[h[i].employeeId].scheduled,m=k-l,n=m>0?"Green":"Red";f+="<div style='display:inline; color:"+n+";' >(Hours Left:"+m+")</div>"}var o=h[i].employeeId;if(g+="<tr>",g+="<td><label>"+f+'</td><td><input type="'+c+'" name="'+j+'" value='+o+' onclick="initSelectMenu();"></label></td>',i+1<h.length){var p=h[i+1].title.split(" "),p=p[0]+" "+p[1];if(0!=e){var k=e[h[i+1].employeeId].desired.split("-")[1],l=e[h[i+1].employeeId].scheduled,m=k-l,n=m>0?"Green":"Red";p+="<div style='display:inline; color:"+n+";' >(Hours Left:"+m+")</div>"}var q=h[i+1].employeeId;"checkbox"==c&&j++,g+="<td><label>"+p+'</td><td><input type="'+c+'" name="'+j+'" value='+q+' onclick="initSelectMenu();"></label></td>'}g+="</tr>"}return g+="</table><table><tr><td>Other Employees:</td><td>"+selectList+"</td></tr>","checkbox"==c&&1==d&&($("#floorOption").attr("checked","checked"),g+=$("#editEventPopup").html()),g}function makeTemplateForm(a,b,c){for(var d="group",e="<table>",f=getEmployeesAvailable(a,b),g=0;g<f.length;g+=2){var h="group";"checkbox"==c&&(h=g);var d=f[g].title.split("(")[0],i=f[g].employeeId;if(e+="<tr>",e+="<td><label>"+d+'</td><td><input type="'+c+'" name="'+h+'" value='+i+' onclick="initSelectMenu();"></label></td>',g+1<f.length){var j=f[g+1].title.split("(")[0],k=f[g+1].employeeId;"checkbox"==c&&h++,e+="<td><label>"+j+'</td><td><input type="'+c+'" name="'+h+'" value='+k+' onclick="initSelectMenu();"></label></td>'}e+="</tr>"}return e+="</table><table><tr><td>Other Employees:</td><td>"+selectList+"</td></tr>"}function scheduleEmployee(a,b){for(var c=new Date(a.getFullYear(),a.getMonth(),a.getDate()-a.getDay()),d=new Date(c.getFullYear(),c.getMonth(),c.getDate()+6),e=getEmployeesAvailable(a,b),f=0;f<e.length;f++)e[f]=e[f].employeeId;$.ajax({type:"POST",url:url+"index.php/manager/getHoursLeft",data:{start:c,end:d,employees:e},success:function(c){var d=jQuery.parseJSON(c);continueScheduling(a,b,d)},error:function(a,b,c){alert(c+" getHoursLeft")}})}function continueScheduling(a,b,c){var d={state0:{title:"Shift: "+(a.getMonth()+1)+"/"+a.getDate()+"/"+a.getFullYear()+"<br>From: "+startTime+" Until: "+endTime,html:makeForm(a,a,"checkbox",!0,c)+"</table>",submit:function(c,d,e,f){day=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate();var g=0;for(var h in f)if(g=1==f.SFL?1:g,"category"!=h)if("emptyShift"!=h){var i=f[h];"NA"!=i&&"undefined"!=typeof i&&""!=i&&0!=i&&"SFL"!=h&&$.ajax({type:"POST",data:{employeeId:i,day:day,begin:a.toTimeString().split(" ")[0],end:b.toTimeString().split(" ")[0],category:f.category,sfl:g,eventTitle:-1},url:url+"index.php/manager/scheduleEmployee",success:function(a){var b=jQuery.parseJSON(a),c=jQuery.parseJSON(b[0]),d=b[1];1==d?$("#calendar").fullCalendar("refetchEvents"):$("#calendar").fullCalendar("renderEvent",c)},error:function(a,b,c){alert(c+"/manager/scheduleEmployee")}})}else addEmptyShift(a,b,f.category,g)}}};$.prompt(d)}function promptEmployeeHPW(a){$.ajax({type:"POST",url:url+"index.php/manager/getEmployeeWeekHours",data:{employeeId:a.employeeId,dayNum:a.start.getDay(),date:a.start.toDateString()},success:function(b){var c=JSON.parse(b);document.getElementById("desired").innerHTML="Desired Hours: "+c.desired,document.getElementById("current").innerHTML="Scheduled Hours: "+c.scheduled,document.getElementById("notes").innerHTML="Notes: "+c.notes,$("#employeeInfo").dialog(),$("#employeeInfo").dialog("option","title",a.title),$("#employeeInfo").dialog("option","position",["middle",100])}})}function scheduleShiftClick(a){var b,c,d=[a.employeeId],e=a.start,f=new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay()),g=new Date(f.getFullYear(),f.getMonth(),f.getDate()+6);"Custom"==a.category||"events"==a.category?(b=a.start.toTimeString().split(" ")[0],c=a.end.toTimeString().split(" ")[0]):"Available"==a.category&&(0==a.start.getDay()?(b="11:45:00",c="18:00:00"):6==a.start.getDay()?(b="09:45:00",c="18:30:00"):(b="09:45:00",c="20:30:00")),"events"!=a.category?$.ajax({type:"POST",url:url+"index.php/manager/getHoursLeft",data:{start:f,end:g,employees:d},success:function(d){var e=jQuery.parseJSON(d);continueScheduleShiftClick(a,e,b,c)},error:function(a,b,c){alert(c+" getHoursLeft")}}):continueScheduleShiftClick(a,null,b,c)}function continueScheduleShiftClick(a,b,c,d){if(null!=b){var e=b[a.employeeId].desired.split("-")[1],f=b[a.employeeId].scheduled,g=e-f,h=g>0?"Green":"Red";g="<div style='display:inline; color:"+h+";' >(Hours Left:"+g+")</div>"}$("#start").children("option").each(function(){$(this).val()==c?$(this).attr("selected","selected"):$(this).removeAttr("selected")}),$("#end").children("option").each(function(){$(this).val()==d?$(this).attr("selected","selected"):$(this).removeAttr("selected")});var i=$("#customTimes").html();$(".rightClickMenuItem").each(function(){$(this).removeAttr("checked")}),"SP"==a.position?$("#supportOption").attr("checked","checked"):$("#floorOption").attr("checked","checked"),i+="Add Empty Shift:<input type='checkbox' name='emptyShift' />",i+=$("#editEventPopup").html(),$("#sflRightClickItem").removeAttr("checked"),eventTitle=-1;var j=a.title.split(" ");j=j[0]+" "+j[1]+" ";var k="Schedule "+j;"events"==a.category&&(k="Schedule Employee for "+a.title.split("(")[0]+" At "+a.location,i="Employee: "+selectList,i+=$("#customTimes").html(),i+="Add Empty Shift:<input type='checkbox' name='emptyShift' />",eventTitle=a.title.split("(")[0]),k+=g?g:"",$.prompt(i,{title:k,buttons:{Submit:1,Cancel:2},submit:function(b,c,d,e){var f="events"==a.category?e.group:a.employeeId,g=e.emptyShift;if(1==c&&("NA"!=f&&$.ajax({type:"POST",data:{employeeId:f,day:a.start.toDateString(),begin:e.start,end:e.end,category:e.category,sfl:e.SFL,eventTitle:eventTitle},url:url+"index.php/manager/scheduleEmployee",success:function(a){var b=jQuery.parseJSON(a),c=jQuery.parseJSON(b[0]),d=b[1];1==d?$("#calendar").fullCalendar("refetchEvents"):$("#calendar").fullCalendar("renderEvent",c)},error:function(a){alert(a+" scheduleEmployee")}}),"on"==g)){var h=a.start;h.setHours(e.start.split(":")[0]),h.setMinutes(e.start.split(":")[1]);var i=new Date(h.getFullYear(),h.getMonth(),h.getDate(),e.end.split(":")[0],e.end.split(":")[1],0),j=-1==eventTitle?e.category:eventTitle;addEmptyShift(h,i,j,e.sfl)}return!0}})}function clearEditEventPopup(){$(".rightClickMenuItem").each(function(){"SP"!=$(this).val()&&($(this).removeAttr("selected"),$(this).removeAttr("checked"))})}function toggleEmployeeAvailability(){var a=$("#toggleEmployeeAvailability").data("employeeId"),b=$.inArray(Number(a),removedEmployees);-1==b?(removedEmployees.push(Number(a)),$("#calendar").fullCalendar("removeEvents",function(b){return b.employeeId==a&&"Available"==b.category||"Custom"==b.category||"Busy"==b.category?!0:!1})):(removedEmployees.splice(b,1),$("#calendar").fullCalendar("refetchEvents"))}function resetAvailability(){removedEmployees=[0],$("#calendar").fullCalendar("refetchEvents"),$("#employeeRightClickDiv").hide()}function repeatOptionChanged(){value=$("#coEventRepeating").val(),"0"==value?$("#coEventRepeatEnd").attr("disabled","disabled").val(""):$("#coEventRepeatEnd").removeAttr("disabled")}function addCOEvent(a,b,c,d,e,f,g){$.ajax({type:"POST",url:url+"index.php/manager/addCOEvent",data:{title:a,date:b,start:c,end:d,location:e,repeating:f,endRepeat:g},success:function(){$("#calendar").fullCalendar("removeEventSource",url+"index.php/manager/coEventSource"),$("#calendar").fullCalendar("addEventSource",url+"index.php/manager/coEventSource")},error:function(a,b){alert(b+" addCOEvent")}})}function addEmptyShift(a,b,c,d){$.ajax({type:"GET",url:url+"index.php/manager/addEmptyShift",data:{date:a.toDateString(),start:a.toTimeString().split(" ")[0],end:b.toTimeString().split(" ")[0],category:c,sfl:d},success:function(){$("#calendar").fullCalendar("refetchEvents")},error:function(a,b){alert(b+" addEmptyShift")}})}function deleteEvent(a,b,c){$.ajax({type:"POST",url:url+"index.php/manager/deleteEvent",data:{id:b,table:a},success:function(){calendar.fullCalendar("removeEvents",c)},error:function(a,b,c){alert(c+" deleteEvent")}})}function fillEmptyShift(a){a.start.setSeconds(0),a.end.setSeconds(0);var b,c=a.start.toTimeString().split(" ")[0],d=a.end.toTimeString().split(" ")[0],e=a.position,f="true"==a.event?e:-1;-1==f&&$("#editEventPopup").each(function(){$(this).id==e?$(this).attr("selected","selected"):$(this).removeAttr("selected")}),$("#start").children("option").each(function(){$(this).val()==c?$(this).attr("selected","selected"):$(this).removeAttr("selected")}),$("#end").children("option").each(function(){$(this).val()==d?$(this).attr("selected","selected"):$(this).removeAttr("selected")}),b=makeForm(a.start,a.end,"radio"),b+=$("#customTimes").html()+"</table>",$.prompt(b,{title:"Fill Empty Shift for "+a.position,buttons:{Submit:1,Cancel:2},submit:function(b,c,d,e){if(2==c)return!0;deleteEvent("emptyShifts",a.rowId,a.id);var g="object"==typeof e.group?e.group[0]:e.group;return"undefined"!=typeof g&&g>0?($.ajax({type:"POST",url:url+"index.php/manager/scheduleEmployee",data:{employeeId:g,day:a.start.toDateString(),begin:e.start,end:e.end,category:a.position,sfl:a.sfl,eventTitle:f},error:function(){alert("Error: scheduleEmployee")},success:function(a){var b=jQuery.parseJSON(a),c=jQuery.parseJSON(b[0]),d=b[1];1==d?$("#calendar").fullCalendar("refetchEvents"):$("#calendar").fullCalendar("renderEvent",c)}}),void 0):!0}})}function updateSort(){var a=$("#sorting").val();$("#calendar").fullCalendar("option","sorting",a),$("#calendar").fullCalendar("refetchEvents")}renderCalendar(30,"month",new Date),$("#external-events").draggable(),$("#options").draggable(),$("#employeeWrapper").resizable({alsoResize:"#employees",handles:"se"}),$("#colors").draggable(),$(document).click(function(a){if($("#editEventPopup").is(":visible")){var b=$("#editEventPopup").offset(),c=$("#editEventPopup").width(),d=$("#editEventPopup").height();a.pageX<b.left||a.pageX>b.left+c?$("#editEventPopup").hide():(a.pageY<b.top||a.pageY>b.top+d)&&$("#editEventPopup").hide()}if($("#employeeRightClickDiv").is(":visible")){var b=$("#employeeRightClickDiv").offset(),c=$("#employeeRightClickDiv").width(),d=$("#employeeRightClickDiv").height();a.pageX<b.left||a.pageX>b.left+c?$("#employeeRightClickDiv").hide():(a.pageY<b.top||a.pageY>b.top+d)&&$("#employeeRightClickDiv").hide()}if($("#overrideAvailability").is(":visible")){var b=$("#overrideAvailability").offset(),c=$("#overrideAvailability").width(),d=$("#overrideAvailability").height();a.pageX<b.left||a.pageX>b.left+c?$("#overrideAvailability").hide():(a.pageY<b.top||a.pageY>b.top+d)&&$("#overrideAvailability").hide()}}),$(".overrideRightClick").click(function(){var a=$(this).data("event");$(this).data("element");var b,c,d=$(this).val(),e={id:a.rowId,category:d};"Custom"==d?$.prompt($("#customTimes").html(),{title:"Custom Times For "+a.title.split("-")[0],buttons:{Submit:1,Cancel:0},submit:function(f,g,h,i){return 0==g?!0:(b=i.start,c=i.end,e={id:a.rowId,category:d,start:b,end:c},$.ajax({type:"POST",url:url+"index.php/manager/overrideAvailability",data:e,success:function(){$("#calendar").fullCalendar("refetchEvents")},error:function(a,b,c){alert("overrideAvailability "+c)}}),void 0)}}):$.ajax({type:"POST",url:url+"index.php/manager/overrideAvailability",data:e,success:function(){$("#calendar").fullCalendar("refetchEvents")},error:function(a,b,c){alert("overrideAvailability "+c)}}),$("#overrideAvailability").hide()}),$(".rightClickMenuItem").click(function(){var a=$(this).data("event");$(this).data("element");var b=$(this).val();$.ajax({type:"POST",url:url+"index.php/manager/updateShiftCategory",data:{id:a.rowId,category:b},success:function(){a.area=b,a.title=a.title.split("(")[0]+"("+b+")",a.color="SP"==a.area?"#EB8F00":"#3366CC",$("#calendar").fullCalendar("updateEvent",a)},error:function(a,b,c){alert(c+"updateShiftCategory")}}),$("#editEventPopup").hide()}),$("#sflRightClickItem").click(function(){var a=$(this).data("event");$(this).data("element");var b=$(this).is(":checked")?1:0;$.ajax({type:"POST",url:url+"index.php/manager/updateSFL",data:{id:a.rowId,sfl:b},success:function(){a.sfl=b,1==b?(a.title+=" (SFL)",a.color="#B81900",a.borderColor="#000000"):(a.title=a.title.split("(SFL)")[0],a.borderColor="",a.color="SP"==a.area?"#EB8F00":"#3366CC"),$("#calendar").fullCalendar("updateEvent",a)},error:function(a,b,c){alert(c+"updateSFL")}})}),$("#viewInfo").click(function(){var a=$("#calendar").fullCalendar("getDate"),b=$("#calendar").fullCalendar("getView"),c=$("#calendar").fullCalendar("getDate");"month"==b.name?(a.setDate(1),c.setMonth(c.getMonth()+1),c.setDate(0)):("agendaWeek"==b.name||"basicWeek"==b.name)&&(c.setDate(c.getDate()+6-c.getDay()),a.setDate(a.getDate()-a.getDay()));var d="";$.ajax({type:"POST",url:url+"index.php/manager/getTotalInfo",data:{start:a.toDateString(),end:c.toDateString(),view:b.name},success:function(b){var e=jQuery.parseJSON(b);d+="<table><th>Name</th><th>Total Hours</th><th>Desired Hours</th>";for(var f in e)d+=e[f];d+="</table>",$.ajax({type:"POST",url:url+"index.php/manager/getHourWageInfo",data:{start:a.toDateString(),end:c.toDateString()},success:function(a){var b=[{title:"Current View Summary",html:a,buttons:{Exit:0,"Employee Summary":1},submit:function(a,b){return 1==b?($.prompt.nextState(),!1):void 0}},{title:"Scheduled Employee Summary",html:d,buttons:{Back:-1,Done:2},submit:function(a,b){-1==b&&$.prompt.prevState()}}];$.prompt(b)},error:function(a){alert(a+"getHourWageInfo")}})},error:function(a){alert(a+"getTotalInfo")}})}),$("select").each(function(){$(this).wrap('<div class="styled-select" />')}),$("#finalize").click(function(){var a=$("#calendar").fullCalendar("getDate"),b=getStartAndEndDates($("#calendar").fullCalendar("getView").name,a),c=b.endDate;document.getElementById("finalizeConfirmation").innerHTML="Are you sure you would like to finalize the schedule until "+b.endDate.toDateString(),c.setDate(c.getDate()+1),$("#finalizeConfirmation").dialog({autoOpen:!1,position:["middle",200],buttons:{Yes:function(){$(this).dialog("close"),$.ajax({type:"POST",url:url+"index.php/manager/finalize",data:{start:c.toDateString()},success:function(){},error:function(a,b,c){alert(c+"finalize")}})},Cancel:function(){$(this).dialog("close")}}}),$("#finalizeConfirmation").dialog("open")}),$("#logOut").click(function(){window.location=url+"index.php/manager/logOut"}),$("#home").click(function(){window.location=url+"index.php/user"}),$("#template").click(function(){if("basicWeek"==$("#calendar").fullCalendar("getView").name){var a=$("#calendar").fullCalendar("getDate");a.setDate(a.getDate()-a.getDay());var b=new Date(a.getFullYear(),a.getMonth(),a.getDate()+6),c={state0:{title:"Select the employee to use for the model of the template.",html:makeTemplateForm(a,b,"radio")+"<tr><td>Template Name:</td><td><input type='text' name='templateName'></input></td></tr></table>",submit:function(a,b,c,d){createTemplate(d.group,d.templateName)}}};$.prompt(c)}}),$("#selectTime").change(function(){var a=$("#calendar").fullCalendar("getView").name,b=$("#calendar").fullCalendar("getDate");renderCalendar(parseInt($(this).val()),a,b)}),$("#busyOption").click(function(){var a=$(this);$.ajax({type:"GET",url:url+"index.php/manager/toggleOption",data:{option:"busy"},success:function(){a.is(":checked")?$("#calendar").fullCalendar("refetchEvents"):$("#calendar").fullCalendar("removeEvents",function(a){return"Busy"==a.category?!0:!1})}})}),$("#scheduledOption").click(function(){$(this).is(":checked")?$("#calendar").fullCalendar("addEventSource",url+"index.php/manager/scheduledEventSource"):$("#calendar").fullCalendar("removeEventSource",url+"index.php/manager/scheduledEventSource")}),$("#availableOption").click(function(){$(this).is(":checked")?$("#calendar").fullCalendar("addEventSource",url+"index.php/manager/eventSource"):$("#calendar").fullCalendar("removeEventSource",url+"index.php/manager/eventSource")}),$("#sflOption").click(function(){$("#toggleAll").removeAttr("checked"),employees=!1,$(".employeeName").each(function(){document.getElementById($(this).attr("id")).style.color="Black"});var a=!1;$(this).is(":checked")&&(a=!0),$.ajax({type:"POST",url:url+"index.php/manager/showSFLOnly",data:{value:a},success:function(b){for(var c=jQuery.parseJSON(b),d=1==a?"Green":"Black",e=0;e<c.length;e++)document.getElementById(c[e]).style.color=d;$("#calendar").fullCalendar("refetchEvents")},error:function(a){alert(a+"getSFLArray")}})}),$("#toggleAll").click(function(){var a=!1;$("#sflOption").removeAttr("checked"),$("#toggleAll").is(":checked")?(a=!0,employees=!0,$("#employees").children("button").each(function(){document.getElementById($(this).attr("id")).style.color="Green"})):(a=!1,employees=!1,$("#employees").children("button").each(function(){document.getElementById($(this).attr("id")).style.color="Black"}),$("#calendar").fullCalendar("removeEvents")),$.ajax({type:"POST",data:{disp:employees},url:url+"index.php/manager/toggleAll",success:function(){1==a&&$("#calendar").fullCalendar("refetchEvents")},error:function(a,b){alert(b+"toggleAll")}})}),$("#addCOEvent").click(function(){$("#coEventDatePicker").datepicker({dateFormat:"yy-mm-dd",showButtonPanel:!0,prevText:"__",nextText:"__"}),$("#addCoEvent").dialog({buttons:{Submit:function(){var a=$("#coEventTitle").val(),b=$("#coEventDatePicker").val(),c=$("#coEventRepeating").val(),d=$("#coEventLocation").val(),e=$("#coEventStart").val(),f=$("#coEventEnd").val(),g=$("#coEventRepeatEnd").val(),h=e.split(":"),i=f.split(":");return""==a?(alert("You Must Enter a Title"),!1):""==b?(alert("You Must Enter a Date"),!1):c>0&&""==g?(alert("You must enter an End Repeat Value"),!1):($(this).dialog("close"),a+="("+timeToString(new Date(0,0,0,h[0],h[1],h[2]))+"-"+timeToString(new Date(0,0,0,i[0],i[1],i[2]))+")",addCOEvent(a,b,e,f,d,c,g),void 0)},Cancel:function(){$(this).dialog("close")}}})}),$("#eventOption").click(function(){$(this).is(":checked")?$("#calendar").fullCalendar("addEventSource",url+"index.php/manager/coEventSource"):$("#calendar").fullCalendar("removeEventSource",url+"index.php/manager/coEventSource")}),$(".employeeName").bind("contextmenu",function(a){-1!=$.inArray(Number(a.currentTarget.id),removedEmployees)?$("#toggleEmployeeAvailability").attr("checked","checked"):$("#toggleEmployeeAvailability").removeAttr("checked"),$("#employeeRightClickDiv").show().offset({top:a.pageY,left:a.pageX}),$("#employeeRightClickDiv input").data("employeeId",Number(a.currentTarget.id)),a.preventDefault()}),$(document).keypress(function(a){if(!$(a.target).is("input")&&!$(a.target).is("select")){var b=a.keyCode?a.keyCode:a.which;70==b||102==b?$("#sflOption").trigger("click"):103==b||71==b?$("#viewInfo").trigger("click"):101==b||69==b?$("#toggleAll").trigger("click"):68==b?$("#deleteOption").trigger("click"):115==b||83==b?$("#scheduledOption").trigger("click"):98==b||66==b?$("#busyOption").trigger("click"):97==b||65==b?$("#availableOption").trigger("click"):37==b?($("#calendar").fullCalendar("prev"),a.preventDefault()):39==b?($("#calendar").fullCalendar("next"),a.preventDefault()):100==b?$("#calendar").fullCalendar("changeView","agendaDay"):119==b||68==b?$("#calendar").fullCalendar("changeView","basicWeek"):(109==b||77==b)&&$("#calendar").fullCalendar("changeView","month")}});var tutorialSubmit=function(a,b){return-1===b?($.prompt.prevState(),$(".jqibox").css("height",$(document).height()),$(".jqifade").css("height",$(document).height()),!1):1===b?($.prompt.nextState(),$(".jqibox").css("height",$(document).height()),$(".jqifade").css("height",$(document).height()),!1):void 0},tutorialStates=[{title:"Welcome",html:"Would you like to take a tutorial of the scheduling software?",buttons:{Sure:1},focus:1,position:{container:"#container",x:0,y:0,width:300},submit:function(a,b){return-1===b?($.prompt.prevState(),!1):1===b?($("#top").removeClass("top"),$("#top").addClass("temp"),$("#menu").removeClass("menu"),$("#menu").addClass("menuTemp"),$.prompt.nextState(),!1):void 0}},{title:"Menu Bar",html:"Here is your menu bar. There is alot of important stuff here! Lets take a closer look...",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#menu",x:-300,y:10,width:300,arrow:"rt"},submit:tutorialSubmit},{title:"Templates",html:"This button allows you to make scheduling templates.  When in the week view, you can make a template of a given employees schedule.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#menu",x:10,y:60,width:300,arrow:"tc"},submit:tutorialSubmit},{title:"Templates",html:"Once a template is created, it will show up in this section.  You can name your templates anything you like.  Clicking on the template will show you the details of the template. You can now drag it onto to calendar to schedule employees based on the template.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#external-events",x:190,y:0,width:300,arrow:"lt"},submit:tutorialSubmit},{title:"Tutorial",html:"Click the tutorial button if you ever need to see this tutorial again.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#menu",x:120,y:60,width:300,arrow:"tc"},submit:tutorialSubmit},{title:"Add Event",html:"This button allows you to add store related events to the Calendar. You can either add a single event, or a weekly repeating event. Employees can then be scheduled to work the events.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#menu",x:215,y:60,width:300,arrow:"tc"},submit:tutorialSubmit},{title:"Finalize Schedule",html:"This button allows you to push the schedule out to all employees. Clicking finalize schedule will make the schedule viewable for employees for all days until the last day in your current view.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#menu",x:200,y:60,width:300,arrow:"tr"},submit:tutorialSubmit},{title:"Employees",html:"This box contains a list of your employees. Clicking on their name will toggle the visibility of their availability and scheduled days",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#employees",x:150,y:0,width:300,arrow:"lt"},submit:tutorialSubmit},{title:"Options",html:"This area shows the options that can be changed at any point to display various information. Click to delete allows for deleting of scheduled events by clicking.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#options",x:170,y:0,width:300,arrow:"lt"},submit:tutorialSubmit},{title:"Time Slot",html:"This drop down list will update the time slots shown in the week and day views",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#selectTimeSlot",x:170,y:-10,width:300,arrow:"lt"},submit:tutorialSubmit},{title:"Availability",html:"Availability is color coded. Black indicates that the employee is busy and cannot work that day. Green indicates the employee is free all day, and Blue indicates a custom availability.",position:{container:"#container",x:0,y:0,width:300},buttons:{Prev:-1,Next:1},focus:1,submit:tutorialSubmit},{title:"Scheduling",html:"When in the month view, clicking on a day will switch to view that day. You can also manually switch between views using these buttons.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#headerButtons",x:-10,y:-10,width:300,arrow:"rm"},submit:function(a,b){return-1===b?($.prompt.prevState(),!1):1===b?($("#calendar").fullCalendar("changeView","agendaDay"),$("#calendar").fullCalendar("addEventSource",url+"index.php/manager/tutorialEvents"),$("#calendar").fullCalendar("gotoDate",new Date("2012","0","1")),$.prompt.nextState(),!1):void 0
}},{title:"Scheduling Continued",html:"When in the day view, employees can be scheduled by simply dragging from the desired start time to the end time. A pop up window will allow for the selection of one or multiple employees for the selected shift. You can also schedule employees by holding the shift key and clicking on an availability event.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#headerButtons",x:150,y:100,width:300},submit:tutorialSubmit},{title:"Shift Editing",html:"Scheduled events can be shifted and resized by clicking and dragging",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#headerButtons",x:150,y:200,width:300},submit:tutorialSubmit},{title:"Employee Information",html:"Clicking on an employees scheduled shift while holding down the shift key will show a window with information about their weekly desired hours, current week scheduled hours, and special notes.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#headerButtons",x:150,y:200,width:300},submit:tutorialSubmit},{title:"Statistical Information",html:"This button provides a popup containing information about sales goals, labor costs, total hours, and more.  It also provides a summary of all scheduled employees and their current scheduled hours vs. their desired hours.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#employees",x:165,y:-45,width:300,arrow:"lt"},submit:tutorialSubmit},{title:"The End!",html:"Now you are ready to use the Scheduling Software! If you have any questions, feel free to contact Giancarlo Anemone at ganemone@gmail.com",buttons:{Done:2},focus:1,position:{container:"#container",x:0,y:0,width:300},submit:function(){$("#calendar").fullCalendar("removeEventSource",url+"index.php/manager/tutorialEvents"),$("#calendar").fullCalendar("gotoDate",new Date),$("#calendar").fullCalendar("changeView","month"),setTutorial(!1),$("#menu").removeClass("temp"),$("#top").removeClass("temp"),$("#menu").addClass("menu"),$("#top").addClass("top")}}];$("#tutorial").click(function(){setTutorial(!0),$.prompt(tutorialStates,{close:function(){tutorial=!1,$("#menu").removeClass("menuTemp"),$("#top").removeClass("temp"),$("#menu").addClass("menu"),$("#top").addClass("top")}})});