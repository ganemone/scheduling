function initializeGoals(){sendRequest("GET",url+"index.php/manager/initializeGoals",{},function(a){return global_goal_arr=jQuery.parseJSON(a),showGoals($("#calendar").fullCalendar("getView"))},!0)}function showGoals(a){if("undefined"==typeof global_goal_arr)return!1;var b=$("#calendar").fullCalendar("getDate").getMonth(),c=(new Date).getMonth();if(c-2>b||b>c+2)return $("span.fc-header-title h2").fadeIn(),!1;var d=getStartAndEndDates(a.name,$("#calendar").fullCalendar("getDate")),e=0,f=0;if("basicWeek"==a.name){var g=d[0];$("th.fc-day-header").each(function(){var a=$(this);if(a.is(":visible")){var b=makeGoalKey(g);g.setDate(g.getDate()+1);var c=a.html(),d=c.split("<br>");"undefined"!=typeof global_goal_arr[b]&&(f=global_goal_arr[b],e+=Number(f.split("$")[1].replace(/,/g,""))),$(a).html(d[0]+"<br><small>("+f+")</small>")}})}else if(d[0]==d[1])f=global_goal_arr[makeGoalKey(d[0])],e+=Number(f.split("$")[1].replace(/,/g,""));else for(var h=d[0],i=d[0].getDate();i<d[1].getDate();i++)f=global_goal_arr[makeGoalKey(h)],e+=Number(f.split("$")[1].replace(/,/g,"")),h.setDate(h.getDate()+1);var j=$("span.fc-header-title h2").text(),k=j.split("(");return $("span.fc-header-title h2").text(k[0]+" ($"+commaSeparateNumber(e)+")"),$("span.fc-header-title h2").fadeIn(),$("#calendar").fullCalendar("refetchEvents"),!0}function getStartAndEndDates(a,b){var c,d,e;return"basicWeek"==a?(d=new Date(b.getFullYear(),b.getMonth(),b.getDate()-b.getDay()),e=new Date(d.getFullYear(),d.getMonth(),d.getDate()+6),c=new Array(d,e)):"month"==a?(d=new Date(b.getFullYear(),b.getMonth(),1),e=new Date(d.getFullYear(),d.getMonth()+1,0),c=new Array(d,e)):"agendaDay"==a&&(c=new Array(b,b)),c}function deletePost(a){bootbox.confirm("Are you sure you would like to delete this post?",function(b){b===!0&&sendRequest("GET",url+"index.php/news/deletePost",{messageId:a},function(){$("#message"+a).hide()},!0)})}function updatePost(a){var b=$("#message"+a+" textarea").val();bootbox.prompt("Employee ID",function(c){return null===c?!0:(sendRequest("GET",url+"index.php/news/updateNewsfeedPost",{employeeId:c,messageId:a,message:b},function(b){return"false"==b?(alert("Please enter a correct Employee ID"),updatePost(a)):(successMessage("Updated post successfully"),!0)},!0),void 0)})}function addNewPost(){var a=$("#newPostTextArea").val();bootbox.prompt("Employee ID",function(b){return null===b?!0:(sendRequest("GET",url+"index.php/news/addNewsfeedPost",{employeeId:b,message:a},function(a){return"false"==a?(alert("Please enter a valid Employee ID"),addNewPost()):(successMessage("Successfully added new post"),reloadNewsfeed(),void 0)},!0),!0)})}function reloadNewsfeed(){sendRequest("GET",url+"index.php/news/reloadNewsfeed",{},function(a){$("#newsfeed").replaceWith(a)},!0)}function addMissedSale(){var a="<form class='form-horizontal' id='missedSaleForm' style='width: 500px;'><div class='form-group'><label for='miss_description' class='col-2 control-label'>Description</label><div class='col-10'><input type='text' class='form-control' placeholder='Enter description here'    name='description' id='miss_description'></div></div><div class='form-group'><label for='miss_style'>Style Number<input type='text' class='form-control' placeholder='Enter style number here'    name='style' id='miss_style'></label></div><div class='form-group'><label for='miss_color'>Color Code<input type='text' class='form-control' placeholder='Enter color code here'      name='color' id='miss_color'></label></div><div class='form-group'><label for='miss_size' >Size<input type='text' class='form-control' placeholder='Enter size here'            name='size'  id='miss_size'></label></div><div class='form-group'><label for='miss_price'>Price<input type='text' class='form-control' placeholder='Enter price here, ex: 0.00' name='price' id='miss_price'></label></div></form>";bootbox.confirm(a,function(a){if(a===!0){var b=$("#missedSaleForm"),c={description:b.description,style:b.style,color:b.color,size:b.size,price:b.price};sendRequest("POST",url+"index.php/sfl/addMissedSale",c,function(){},!0)}return!0})}function validateMissedSaleForm(a){var b,c,d,e;return b=a.price,e=new RegExp("[^0123456789.]"),c=!0,d=null,""===a.description&&(c=!1,d="The description field is required."),e.test(b)===!0&&(c=!1,d="The price was entered incorrectly. Please enter the price in the format 100.00, 5.00, etc."),b>1e3&&(c=!1,d="The price field may not exceed 1000 dollars."),[c,d]}function addStory(){var a="<form class='form-inline'><fieldset><div class='form-group text-left'><label for='story_employeeId'>Employee ID </label><input id='story_employeeId' class='placeholder='Enter Employee ID Here...' name='employeeId'></div><div class='form-group text-left'><textarea name='story' rows=10 cols=35 placeholder='Tell us what awesome thing you did today!'></textarea></div></fieldset></form>";bootbox.confirm(a,function(a){a===!0&&ajaxAddStory($("#story_employeeId").val(),$("#story").val())})}function ajaxAddStory(a){var b=a.employeeId,c=a.story,d=new RegExp("[^0123456789]"),e=new Date;return d.test(b)===!0?(alert("Please enter a valid employeeId"),!1):""===c?(alert("You forgot to tell us why you're so awesome!"),!1):(sendRequest("POST",url+"index.php/sfl/addStory",{date:e.toDateString(),employeeId:b,story:c},function(a){"false"==a&&alert("I'm not sure who you are... Please try again, and make sure you entered your employeeId in correctly.")},!0),void 0)}function getEmailTemplate(){var a=new Date;sendRequest("GET",url+"index.php/sfl/getEmailTemplate",{date:a.toDateString()},function(a){message="<h3>Nightly Email for "+(new Date).toDateString()+"</h3><br>",bootbox.alert(message+a),selectElementText($("emailTemplate"))},!0)}function selectElementText(a){a.selText().addClass("highlighted")}function makeGoalKey(a){var b=a.getFullYear()+"-";return b+=Number(a.getMonth()+1)<10?"0":"",b+=Number(a.getMonth()+1)+"-",b+=a.getDate()<10?"0":"",b+=a.getDate()}function commaSeparateNumber(a){for(;/(\d+)(\d{3})/.test(a.toString());)a=a.toString().replace(/(\d+)(\d{3})/,"$1,$2");return a}var global_goal_arr;initializeGoals(),bootbox.animate(!1),$("#calendar").fullCalendar({header:{left:"prev,next",center:"title",right:"month,basicWeek,agendaDay"},height:600,aspectRatio:1,selectable:!1,slotMinutes:15,minTime:8,maxTime:21,editable:!1,sorting:"standard",defaultView:"agendaDay",timeFormat:"h:mm{ - h:mm}",dayClick:function(a){$("#calendar").fullCalendar("gotoDate",a),$("#calendar").fullCalendar("changeView","agendaDay"),showGoals($("#calendar").fullCalendar("getView"))},eventClick:function(a){$("#calendar").fullCalendar("gotoDate",a.start),$("#calendar").fullCalendar("changeView","agendaDay"),showGoals($("#calendar").fullCalendar("getView"))},viewDisplay:function(a){h="month"==a.name?0/0:3e3,$("span.fc-header-title h2").hide(),$("#calendar").fullCalendar("option","contentHeight",h)},eventSources:[{url:url+"index.php/sfl/floorEventSource",beforeSend:function(){global_ajax_requests++},error:function(a,b){alert(b+"/manager/floorEventSource")},complete:function(){global_ajax_requests--,hideLoading()}}]}),$("#toggleSupportStaff").click(function(){1==support?($("#calendar").fullCalendar("removeEventSource",url+"index.php/sfl/supportEventSource"),support=!1):($("#calendar").fullCalendar("addEventSource",url+"index.php/sfl/supportEventSource"),support=!0)}),$("#toggleStoreEvents").click(function(){1==events?($("#calendar").fullCalendar("removeEventSource",url+"index.php/manager/coEventSource"),events=!1):($("#calendar").fullCalendar("addEventSource",url+"index.php/manager/coEventSource"),events=!0)}),$("#printSchedule").click(function(){window.location=url+"index.php/sfl/printable?events="+events+"&support="+support}),$(document).ready(function(){support===!0&&$("#calendar").fullCalendar("addEventSource",url+"index.php/sfl/supportEventSource"),events===!0&&$("#calendar").fullCalendar("addEventSource",url+"index.php/manager/coEventSource")}),$(window).load(function(){-1==String(window.location).indexOf("printable")?$(".leftNav").css("height",$(window).height()-40):$(".leftNav").hide()}),jQuery.fn.selText=function(){var a,b,c=this[0];return"Internet Explorer"==agent.browser?(b=c.offsetParent.createTextRange(),b.moveToElementText(c),b.select()):"Firefox"==agent.browser||"Opera"==agent.browser?(a=c.ownerDocument.defaultView.getSelection(),b=c.ownerDocument.createRange(),b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)):"Safari"==agent.browser&&(a=c.ownerDocument.defaultView.getSelection(),a.setBaseAndExtent(c,0,c,1)),this},$("span.fc-button.fc-button-prev.fc-state-default.fc-corner-left").click(function(){showGoals($("#calendar").fullCalendar("getView"))}),$("span.fc-button.fc-button-next.fc-state-default.fc-corner-right").click(function(){showGoals($("#calendar").fullCalendar("getView"))}),$("span.fc-button.fc-button-month.fc-state-default.fc-corner-left").click(function(){showGoals($("#calendar").fullCalendar("getView"))}),$("span.fc-button.fc-button-basicWeek.fc-state-default").click(function(){showGoals($("#calendar").fullCalendar("getView"))}),$("span.fc-button.fc-button-agendaDay.fc-state-default.fc-corner-right").click(function(){showGoals($("#calendar").fullCalendar("getView"))});