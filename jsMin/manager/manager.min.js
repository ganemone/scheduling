function renderCalendar(b,c,d){$("#calendar").fullCalendar("destroy");$("#calendar").css("width",$(document).width()-200);b={header:{left:"prev,next",center:"title",right:"month,agendaWeek,basicWeek,agendaDay"},selectable:!0,slotMinutes:b,minTime:8,maxTime:21,editable:!0,resizeable:!0,droppable:!0,defaultView:"month",snapMinutes:15,timeFormat:"h:mm{ - h:mm}",dropAccept:".external-event, .fc-event",buttonText:{agendaWeek:"Adv. Week",basicWeek:"Simple Week"},viewDisplay:function(b){h="month"==b.name?
NaN:3E3;$("span.fc-header-title h2").hide();$("#calendar").fullCalendar("option","contentHeight",h);initializeGoalTips(b)},drop:function(b){$(".fc-event").qtip("hide");var c=$(this).data("eventObject"),d=c.days,j=c.starts,k=c.ends,l=c.categories,m=new Date(b.getFullYear(),b.getMonth(),b.getDate()-b.getDay());b=new Date(m.getFullYear(),m.getMonth(),m.getDate()+6);b={state0:{title:"Schedule Using Template",html:makeTemplateForm(m,b,"checkbox")+"</table>",submit:function(b,c,e,f){for(var p in f)for(b=
0;b<f[p].length;b++){c=f[p];if("NA"==c)break;for(e=0;e<d.length;e++){var n=new Date;n.setFullYear(m.getFullYear());n.setMonth(m.getMonth());n.setDate(m.getDate()+Number(d[e][0]));$.ajax({type:"POST",data:{employeeId:c,day:n.toDateString(),begin:j[e],end:k[e],category:l[e]},url:url+"index.php/manager/scheduleEmployee",success:function(){$("#calendar").fullCalendar("refetchEvents")},error:function(b){alert(b+"/manager/scheduleEmployee")}})}}}}};$.prompt(b)},loading:function(b){b?$("#loading").show():
$("#loading").fadeOut()},eventRender:function(b,c){"scheduled"==b.category&&c.bind("contextmenu",function(d){$("input.rightClickMenuItem").each(function(){$(this).val()==b.area?$(this).attr("checked","checked"):$(this).removeAttr("checked");$(this).data("element",c);$(this).data("event",b)});$("#sflRightClickItem").data("element",c).data("event",b);"(SFL)"==b.sfl?$("#sflRightClickItem").attr("checked","checked"):$("#sflRightClickItem").removeAttr("checked");$("#editEventPopup").show().offset({top:d.pageY,
left:d.pageX});d.preventDefault()});var d="";"scheduled"==b.category||"Custom"==b.category?null!=b.start&&null!=b.end&&(d=b.title+" "+timeToString(b.start)+"-"+timeToString(b.end)):d="events"==b.category?b.title+" At "+b.location:b.title+" "+b.category;c.qtip({content:d,position:{at:"top center",my:"bottom center"},style:{tip:"bottomMiddle",classes:"qtip-dark"},show:{event:"click"},events:{render:function(b,c){c.elements.tooltip.click(c.hide)}}})},eventClick:function(b,c){var d=!1;$("#deleteOption").is(":checked")&&
(d=!0);"scheduled"!=b.category&&c.shiftKey&&"Busy"!=b.category&&scheduleShiftClick(b);if("scheduled"==b.category||"events"==b.category)c.shiftKey&&"scheduled"==b.category?promptEmployeeHPW(b):!0==d&&($("#deleteConfirmation").dialog({autoOpen:!1,modal:!0,position:["middle",100],buttons:{Delete:function(){$.ajax({type:"POST",url:url+"index.php/manager/deleteEvent",data:{id:b.id,table:b.category},success:function(){calendar.fullCalendar("removeEvents",b.id)}});$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}),
$("#deleteConfirmation").dialog("open"))},eventDragStart:function(){$(".fc-event").qtip("hide")},eventDragStop:function(){$(".fc-event").qtip("hide")},eventDrop:function(b,c,d,j,k){$(".fc-event").qtip("hide");eventMove(b,c,d,k)},eventResize:function(b,c,d,j){eventMove(b,c,d,j)},select:function(b,c,d,j){if(d)return calendar.fullCalendar("changeView","agendaDay"),calendar.fullCalendar("gotoDate",b),!0;if(!j.shiftKey){if(!0==tutorial)return!0;d=calendar.fullCalendar("getView").name;j=b.getHours();var k=
c.getHours(),l=b.toTimeString().split(" ")[0].split(":")[1],m=c.toTimeString().split(" ")[0].split(":")[1];startTime=12<j?j-12+":"+l+"pm":j+":"+l+"am";endTime=12<k?k-12+":"+m+"pm":k+":"+m+"am";"month"!=d&&scheduleEmployee(b,c,startTime,endTime);calendar.fullCalendar("unselect")}},eventSources:[{url:url+"index.php/manager/eventSource",data:{busy:busy,removedEmployees:removedEmployees},error:function(b,c){alert(c+"/manager/eventSource")}},{url:url+"index.php/manager/scheduledEventSource",error:function(b,
c){alert(c+"/manager/scheduledEventSource")}},{url:url+"index.php/manager/coEventSource",error:function(b,c){alert(c+"coEventSource")}}]};calendar=$("#calendar").fullCalendar(b);calendar.fullCalendar("gotoDate",d);calendar.fullCalendar("changeView",c)}renderCalendar(30,"month",new Date);$("#external-events").draggable();$("#options").draggable();$("#employeeWrapper").resizable({alsoResize:"#employees",handles:"se"});$("#colors").draggable();
$(document).click(function(b){if($("#editEventPopup").is(":visible")){var c=$("#editEventPopup").offset(),d=$("#editEventPopup").width(),e=$("#editEventPopup").height();b.pageX<c.left||b.pageX>c.left+d?$("#editEventPopup").hide():(b.pageY<c.top||b.pageY>c.top+e)&&$("#editEventPopup").hide()}$("#employeeRightClickDiv").is(":visible")&&(c=$("#employeeRightClickDiv").offset(),d=$("#employeeRightClickDiv").width(),e=$("#employeeRightClickDiv").height(),b.pageX<c.left||b.pageX>c.left+d?$("#employeeRightClickDiv").hide():
(b.pageY<c.top||b.pageY>c.top+e)&&$("#employeeRightClickDiv").hide())});$(".rightClickMenuItem").click(function(){var b=$(this).data("event");$(this).data("element");$.ajax({type:"POST",url:url+"index.php/manager/updateShiftCategory",data:{id:b.id,category:$(this).val()},success:function(){$("#calendar").fullCalendar("refetchEvents")},error:function(b,d,e){alert(e+"updateShiftCategory")}});$("#editEventPopup").hide()});
$("#sflRightClickItem").click(function(){var b=$(this).data("event");$(this).data("element");var c=$(this).is(":checked")?1:0;$.ajax({type:"POST",url:url+"index.php/manager/updateSFL",data:{id:b.id,sfl:c},success:function(){$("#calendar").fullCalendar("refetchEvents")},error:function(b,c,f){alert(f+"updateSFL")}})});
$("#viewInfo").click(function(){var b=$("#calendar").fullCalendar("getDate"),c=$("#calendar").fullCalendar("getView"),d=$("#calendar").fullCalendar("getDate");"month"==c.name?(b.setDate(1),d.setMonth(d.getMonth()+1),d.setDate(0)):"agendaWeek"==c.name&&(d.setDate(d.getDate()+6-d.getDay()),b.setDate(b.getDate()-b.getDay()));var e="";$.ajax({type:"POST",url:url+"index.php/manager/getTotalInfo",data:{start:b.toDateString(),end:d.toDateString()},success:function(c){c=jQuery.parseJSON(c);e+="<table><th>Name</th><th>Total Hours</th><th>Desired Hours</th>";
for(var g in c)e+=c[g];e+="</table>";$.ajax({type:"POST",url:url+"index.php/manager/getHourWageInfo",data:{start:b.toDateString(),end:d.toDateString()},success:function(b){$.prompt([{title:"Current View Summary",html:b,buttons:{Exit:0,"Employee Summary":1},submit:function(b,c){if(1==c)return $.prompt.nextState(),!1}},{title:"Scheduled Employee Summary",html:e,buttons:{Back:-1,Done:2},submit:function(b,c){-1==c&&$.prompt.prevState()}}])},error:function(b){alert(b+"getHourWageInfo")}})},error:function(b){alert(b+
"getTotalInfo")}})});$("select").each(function(){$(this).wrap('<div class="styled-select" />')});
$("#finalize").click(function(){var b=$("#calendar").fullCalendar("getDate"),b=getStartAndEndDates($("#calendar").fullCalendar("getView").name,b),c=b.endDate;document.getElementById("finalizeConfirmation").innerHTML="Are you sure you would like to finalize the schedule until "+b.endDate.toDateString();c.setDate(c.getDate()+1);$("#finalizeConfirmation").dialog({autoOpen:!1,position:["middle",200],buttons:{Yes:function(){$(this).dialog("close");$.ajax({type:"POST",url:url+"index.php/manager/finalize",
data:{start:c.toDateString()},success:function(){},error:function(b,c,f){alert(f+"finalize")}})},Cancel:function(){$(this).dialog("close")}}});$("#finalizeConfirmation").dialog("open")});$("#logOut").click(function(){window.location=url+"index.php/manager/logOut"});$("#home").click(function(){window.location=url+"index.php/manager"});
$("#template").click(function(){if("agendaWeek"==$("#calendar").fullCalendar("getView").name){var b=$("#calendar").fullCalendar("getDate");b.setDate(b.getDate()-b.getDay());var c=new Date(b.getFullYear(),b.getMonth(),b.getDate()+6),b={state0:{title:"Select the employee to use for the model of the template.",html:makeTemplateForm(b,c,"radio")+"<tr><td>Template Name:</td><td><input type='text' name='templateName'></input></td></tr></table>",submit:function(b,c,f,g){createTemplate(g.group,g.templateName)}}};
$.prompt(b)}});$("#selectTime").change(function(){var b=$("#calendar").fullCalendar("getView").name,c=$("#calendar").fullCalendar("getDate");renderCalendar(parseInt($(this).val()),b,c)});$("#busyOption").click(function(){$.ajax({type:"GET",url:url+"index.php/manager/toggleOption",data:{option:"busy"},success:function(){$("#calendar").fullCalendar("refetchEvents")}})});
$("#scheduledOption").click(function(){$(this).is(":checked")?$("#calendar").fullCalendar("addEventSource",url+"index.php/manager/scheduledEventSource"):$("#calendar").fullCalendar("removeEventSource",url+"index.php/manager/scheduledEventSource")});$("#availableOption").click(function(){$(this).is(":checked")?$("#calendar").fullCalendar("addEventSource",url+"index.php/manager/eventSource"):$("#calendar").fullCalendar("removeEventSource",url+"index.php/manager/eventSource")});
$("#sflOption").click(function(){$("#calendar").fullCalendar("removeEvents");$("#toggleAll").removeAttr("checked");employees=!1;$(".employeeName").each(function(){document.getElementById($(this).attr("id")).style.color="Black"});var b=!1;$(this).is(":checked")&&(b=!0);$.ajax({type:"POST",url:url+"index.php/manager/showSFLOnly",data:{value:b},success:function(c){c=jQuery.parseJSON(c);for(var d=!0==b?"Green":"Black",e=0;e<c.length;e++)document.getElementById(c[e]).style.color=d;$("#calendar").fullCalendar("refetchEvents")},
error:function(b){alert(b+"getSFLArray")}})});
$("#toggleAll").click(function(){var b=!1;$("#sflOption").removeAttr("checked");$("#toggleAll").is(":checked")?(employees=b=!0,$("#employees").children("button").each(function(){document.getElementById($(this).attr("id")).style.color="Green"})):(employees=b=!1,$("#employees").children("button").each(function(){document.getElementById($(this).attr("id")).style.color="Black"}),$("#calendar").fullCalendar("removeEvents"));$.ajax({type:"POST",data:{disp:employees},url:url+"index.php/manager/toggleAll",
success:function(){!0==b&&$("#calendar").fullCalendar("refetchEvents")},error:function(b,d){alert(d+"toggleAll")}})});
$("#addCOEvent").click(function(){$("#coEventDatePicker").datepicker({dateFormat:"yy-mm-dd",showButtonPanel:!0,prevText:"__",nextText:"__"});$("#addCoEvent").dialog({buttons:{Submit:function(){$(this).dialog("close");var b=$("#coEventTitle").val(),c=$("#coEventDatePicker").val(),d=$("#coEventRepeating").val(),e=$("#coEventLocation").val(),f=$("#coEventStart").val(),g=$("#coEventEnd").val(),j=$("#coEventRepeatEnd").val(),k=f.split(":"),l=g.split(":"),b=b+("("+timeToString(new Date(0,0,0,k[0],k[1],
k[2]))+"-"+timeToString(new Date(0,0,0,l[0],l[1],l[2]))+")");addCOEvent(b,c,f,g,e,d,j)},Cancel:function(){$(this).dialog("close")}}})});$("#eventOption").click(function(){$(this).is(":checked")?$("#calendar").fullCalendar("addEventSource",url+"index.php/manager/coEventSource"):$("#calendar").fullCalendar("removeEventSource",url+"index.php/manager/coEventSource")});
$(".employeeName").bind("contextmenu",function(b){-1!=$.inArray(Number(b.currentTarget.id),removedEmployees)?$("#toggleEmployeeAvailability").attr("checked","checked"):$("#toggleEmployeeAvailability").removeAttr("checked");$("#employeeRightClickDiv").show().offset({top:b.pageY,left:b.pageX});$("#employeeRightClickDiv input").data("employeeId",Number(b.currentTarget.id));b.preventDefault()});function setTutorial(b){tutorial=b}
function toggleEvents(b){var c=!1;"Black"==document.getElementById(b).style.color?(document.getElementById(b).style.color="Green",c=!0):(document.getElementById(b).style.color="Black",$("#calendar").fullCalendar("removeEvents",function(c){if(c.employeeId==b)return!0}),c=!1);$.ajax({type:"POST",data:{employeeId:b,display:c},url:url+"index.php/manager/toggleDisplay",success:function(){$("#calendar").fullCalendar("refetchEvents")},error:function(b,c){alert(c+"toggleDisplay")}})}
function selectHidden(){$("#hiddenRadio").attr("checked","true")}function initSelectMenu(){$("#firstOption").attr("selected","true")}function stringToTime(b){b=b.split(":");var c=b[1].split(" ");hour=Number(b[0]);"pm"==c[1]&&(hour+=12);return(new Date(0,0,0,hour,c[0],0)).toTimeString().split(" ")[0]}function timeToString(b){b=b.toTimeString().split(" ")[0].split(":");var c="am",d=Number(b[0]);12<Number(b[0])&&(c="pm",d-=12);return d+":"+b[1]+" "+c}
function deleteTemplate(b){$("#deleteOption").is(":checked")&&$("#deleteConfirmation").dialog({autoOpen:!0,position:["middle",100],buttons:{Delete:function(){$(this).dialog("close");$.ajax({type:"POST",url:url+"index.php/manager/deleteTemplate",data:{templateId:$(b).data("eventObject").templateId},success:function(){$(b).qtip("hide").remove()},error:function(b){alert(b+"deleteTemplate")}})},Cancel:function(){$(this).dialog("close")}}})}
function showGoal(b,c){var d;"month"==c.name?(b.setDate(1),d=new Date(b.getFullYear(),b.getMonth()+1,0)):"agendaWeek"==c.name?(b.setDate(b.getDate()-b.getDay()),d=new Date(b.getFullYear(),b.getMonth(),b.getDate()+6)):d=b;$.ajax({type:"GET",url:url+"index.php/manager/getGoal",data:{startDate:b.toDateString(),endDate:d.toDateString()},success:function(){},error:function(b,c,d){alert(d+"getGoal")}})}
function getStartAndEndDates(b,c){var d="";if("agendaWeek"==b||"basicWeek"==b)var d=new Date(c.getFullYear(),c.getMonth(),c.getDate()-c.getDay()),e=new Date(d.getFullYear(),d.getMonth(),d.getDate()+6),d={startDate:d,endDate:e};else if("month"==b)d=new Date(c.getFullYear(),c.getMonth(),1),e=new Date(d.getFullYear(),d.getMonth()+1,0),d={startDate:d,endDate:e};else if("agendaDay"==b||"basicDay"==b)d={startDate:c,endDate:c};return d}
function initializeGoalTips(b){var c=getStartAndEndDates(b.name,$("#calendar").fullCalendar("getDate"));"agendaWeek"==b.name||"basicWeek"==b.name?$.ajax({type:"GET",url:url+"index.php/manager/getGoal",data:{startDate:c.startDate.toDateString(),endDate:c.endDate.toDateString()},success:function(b){var c=$("span.fc-header-title h2").text().split("(");$("span.fc-header-title h2").text(c[0]+" ($"+b+")");$("span.fc-header-title h2").fadeIn()},error:function(b,c,f){alert(f+"getGoalArray")}}):$.ajax({type:"GET",
url:url+"index.php/manager/getGoal",data:{startDate:c.startDate.toDateString(),endDate:c.endDate.toDateString()},success:function(b){var c=$("span.fc-header-title h2").text().split("(");$("span.fc-header-title h2").text(c[0]+" ($"+b+")");$("span.fc-header-title h2").fadeIn()},error:function(b,c,f){alert(f+"getGoal")}})}
function eventMove(b,c,d,e){if("Test Schedule"==b.title)return!0;if("scheduled"!=b.category)e();else{var f=b.employeeId;b.start.getFullYear();b.start.getMonth();b.start.getDate();var g=b.start,j=b.start.toTimeString(),k=b.end.toTimeString();$.ajax({type:"POST",url:url+"index.php/manager/deleteEvent",data:{id:b.id,table:"scheduled"},success:function(){$.ajax({type:"POST",url:url+"index.php/manager/scheduleEmployee",data:{employeeId:f,day:g.toDateString(),begin:j.split(" ")[0],end:k.split(" ")[0],category:b.area,
sfl:b.sfl},success:function(){},error:function(){alert("Error: scheduleEmployee")}})},error:function(){alert("Error: deleteEvent")}})}}function createTemplate(b,c){var d=$("#calendar").fullCalendar("getDate"),e="object"==typeof b?b[0]:b;d.setDate(d.getDate()-d.getDay());$.ajax({type:"POST",url:url+"index.php/manager/makeTemplate",data:{id:e,title:c,date:d.toDateString()},success:function(){loadTemplates()},error:function(){alert("ERROR makeTemplate")}})}
function getEmployeesAvailable(b,c){var d=[];return $("#calendar").fullCalendar("clientEvents",function(e){startDate=new Date(e.start.getFullYear(),e.start.getMonth(),e.start.getDate());beginDate=new Date(b.getFullYear(),b.getMonth(),b.getDate());endDate=new Date(c.getFullYear(),c.getMonth(),c.getDate());return startDate>=beginDate&&startDate<=endDate&&!("Busy"==e.category||"scheduled"==e.category||"events"==e.category)&&-1==$.inArray(e.employeeId,d)?(d.push(e.employeeId),!0):!1})}
function loadTemplates(){var b="";$(".external-event").each(function(){$(this).remove()});$.ajax({type:"GET",url:url+"index.php/manager/loadTemplates",success:function(c){c=jQuery.parseJSON(c);for(var d=0;d<c.length;d++){var e=jQuery.parseJSON(c[d]);b="<div class='external-event' id='template"+d+"' title='"+e.description+"' onclick=deleteTemplate('"+("#template"+d)+"');>"+e.templateName+"</div>";$("#external-events").append(b);$("#template"+d).qtip({content:e.description,position:{my:"bottom left",
at:"top right"},style:{tip:"bottomLeft",classes:"qtip-dark"},show:{event:"click"},events:{render:function(b,c){c.elements.tooltip.click(c.hide)}}});$("#template"+d).data("eventObject",e);$("#template"+d).draggable({zIndex:999,revert:!0,revertDuration:0,scroll:!1,start:function(){$("div.fc-event").qtip("disable");$("div.external-event").qtip("hide");$("div.external-event").qtip("disable")},stop:function(){$("div.fc-event").qtip("enable");$("div.external-event").qtip("enable")}})}},error:function(b){alert(b+
"loadTemplates")}})}
function makeForm(b,c,d,e){e="undefined"!==typeof a?e:!0;var f="group",g="<table>";b=getEmployeesAvailable(b,c);for(c=0;c<b.length;c+=2){var j="group";"checkbox"==d&&(j=c);var f=b[c].title,k=b[c].employeeId,g=g+"<tr>",g=g+("<td><label>"+f+'</td><td><input type="'+d+'" name="'+j+'" value='+k+' onclick="initSelectMenu();"></label></td>');c+1<b.length&&(f=b[c+1].title,k=b[c+1].employeeId,"checkbox"==d&&j++,g+="<td><label>"+f+'</td><td><input type="'+d+'" name="'+j+'" value='+k+' onclick="initSelectMenu();"></label></td>');g+=
"</tr>"}g+="</table><table><tr><td>Other Employees:</td><td>"+selectList+"</td></tr>";"checkbox"==d&&!0==e&&(g+=$("#editEventPopup").html());return g}
function makeTemplateForm(b,c,d){var e="group",f="<table>";b=getEmployeesAvailable(b,c);for(c=0;c<b.length;c+=2){var g="group";"checkbox"==d&&(g=c);var e=b[c].title.split("(")[0],j=b[c].employeeId,f=f+"<tr>",f=f+("<td><label>"+e+'</td><td><input type="'+d+'" name="'+g+'" value='+j+' onclick="initSelectMenu();"></label></td>');c+1<b.length&&(e=b[c+1].title.split("(")[0],j=b[c+1].employeeId,"checkbox"==d&&g++,f+="<td><label>"+e+'</td><td><input type="'+d+'" name="'+g+'" value='+j+' onclick="initSelectMenu();"></label></td>');
f+="</tr>"}return f+="</table><table><tr><td>Other Employees:</td><td>"+selectList+"</td></tr>"}
function scheduleEmployee(b,c,d,e){$("#floorOption").attr("checked","checked");$("#sflRightClickOption").removeAttr("checked");d={state0:{title:"Shift: "+(b.getMonth()+1)+"/"+b.getDate()+"/"+b.getFullYear()+"<br>From: "+d+" Until: "+e,html:makeForm(b,b,"checkbox")+"</table>",submit:function(d,e,j,k){day=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate();for(var l in k){if("category"==l)break;d=k[l];e="on"==k.sfl?1:0;if("NA"==d)break;$.ajax({type:"POST",data:{employeeId:d,day:day,begin:b.toTimeString().split(" ")[0],
end:c.toTimeString().split(" ")[0],category:k.category,sfl:e,eventTitle:-1},url:url+"index.php/manager/scheduleEmployee",success:function(){$("#calendar").fullCalendar("refetchEvents")},error:function(b){alert(b+"/manager/scheduleEmployee")}})}calendar.fullCalendar("refetchEvents")}}};$.prompt(d)}
function promptEmployeeHPW(b){$.ajax({type:"POST",url:url+"index.php/manager/getEmployeeWeekHours",data:{employeeId:b.employeeId,dayNum:b.start.getDay(),date:b.start.toDateString()},success:function(c){c=JSON.parse(c);document.getElementById("desired").innerHTML="Desired Hours: "+c.desired;document.getElementById("current").innerHTML="Scheduled Hours: "+c.scheduled;document.getElementById("notes").innerHTML="Notes: "+c.notes;$("#employeeInfo").dialog();$("#employeeInfo").dialog("option","title",b.title);
$("#employeeInfo").dialog("option","position",["middle",100])}})}
function scheduleShiftClick(b){var c,d;"Custom"==b.category||"events"==b.category?(c=b.start.toTimeString().split(" ")[0],d=b.end.toTimeString().split(" ")[0]):"Available"==b.category&&(0==b.start.getDay()?(c="11:45:00",d="18:00:00"):6==b.start.getDay()?(c="9:45:00",d="19:00:00"):(c="9:45:00",d="21:00:00"));$("#start").children("option").each(function(){$(this).val()==c?$(this).attr("selected","selected"):$(this).removeAttr("selected")});$("#end").children("option").each(function(){$(this).val()==
d?$(this).attr("selected","selected"):$(this).removeAttr("selected")});var e=$("#customTimes").html();$(".rightClickMenuItem").each(function(){$(this).removeAttr("checked")});"SP"==b.position?$("#supportOption").attr("checked","checked"):$("#floorOption").attr("checked","checked");e+=$("#editEventPopup").html();eventTitle=-1;var f="Schedule Employee";"events"==b.category&&(f+=" for "+b.title.split("(")[0]+" At "+b.location,e="Employee: "+selectList,e+=$("#customTimes").html(),eventTitle=b.title.split("(")[0]);
$.prompt(e,{title:f,buttons:{Submit:1,Cancel:2},submit:function(c,d,e,f){c="events"==b.category?f.group:b.employeeId;1==d&&$.ajax({type:"POST",data:{employeeId:c,day:b.start.toDateString(),begin:f.start,end:f.end,category:f.category,sfl:f.SFL,eventTitle:eventTitle},url:url+"index.php/manager/scheduleEmployee",success:function(){calendar.fullCalendar("refetchEvents")},error:function(b){alert(b+" scheduleEmployee")}});return!0}})}
function clearEditEventPopup(){$(".rightClickMenuItem").each(function(){"SP"!=$(this).val()&&($(this).removeAttr("selected"),$(this).removeAttr("checked"))})}function toggleEmployeeAvailability(){var b=$("#toggleEmployeeAvailability").data("employeeId"),c=$.inArray(Number(b),removedEmployees);-1==c?removedEmployees.push(Number(b)):removedEmployees.splice(c,1);$("#calendar").fullCalendar("refetchEvents")}
function resetAvailability(){removedEmployees=[0];$("#calendar").fullCalendar("refetchEvents");$("#employeeRightClickDiv").hide()}function repeatOptionChanged(){value=$("#coEventRepeating").val();"0"==value?$("#coEventRepeatEnd").attr("disabled","disabled").val(""):$("#coEventRepeatEnd").removeAttr("disabled")}
function addCOEvent(b,c,d,e,f,g,j){$.ajax({type:"POST",url:url+"index.php/manager/addCOEvent",data:{title:b,date:c,start:d,end:e,location:f,repeating:g,endRepeat:j},success:function(){$("#calendar").fullCalendar("removeEventSource",url+"index.php/manager/coEventSource");$("#calendar").fullCalendar("addEventSource",url+"index.php/manager/coEventSource")},error:function(b,c){alert(c+" addCOEvent")}})}
$(document).keypress(function(b){if(!$(b.target).is("input")&&!$(b.target).is("select")){var c=b.keyCode?b.keyCode:b.which;70==c||102==c?$("#sflOption").trigger("click"):103==c||71==c?$("#viewInfo").trigger("click"):101==c||69==c?$("#toggleAll").trigger("click"):68==c?$("#deleteOption").trigger("click"):115==c||83==c?$("#scheduledOption").trigger("click"):98==c||66==c?$("#busyOption").trigger("click"):97==c||65==c?$("#availableOption").trigger("click"):37==c?($("#calendar").fullCalendar("prev"),b.preventDefault()):
39==c?($("#calendar").fullCalendar("next"),b.preventDefault()):100==c?$("#calendar").fullCalendar("changeView","agendaDay"):119==c||68==c?$("#calendar").fullCalendar("changeView","agendaWeek"):(109==c||77==c)&&$("#calendar").fullCalendar("changeView","month")}});
var tutorialSubmit=function(b,c){if(-1===c)return $.prompt.prevState(),$(".jqibox").css("height",$(document).height()),$(".jqifade").css("height",$(document).height()),!1;if(1===c)return $.prompt.nextState(),$(".jqibox").css("height",$(document).height()),$(".jqifade").css("height",$(document).height()),!1},tutorialStates=[{title:"Welcome",html:"Would you like to take a tutorial of the scheduling software?",buttons:{Sure:1},focus:1,position:{container:"#container",x:0,y:0,width:300},submit:function(b,
c){if(-1===c)return $.prompt.prevState(),!1;if(1===c)return $("#top").removeClass("top"),$("#top").addClass("temp"),$("#menu").removeClass("menu"),$("#menu").addClass("menuTemp"),$.prompt.nextState(),!1}},{title:"Menu Bar",html:"Here is your menu bar. There is alot of important stuff here! Lets take a closer look...",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#menu",x:-300,y:10,width:300,arrow:"rt"},submit:tutorialSubmit},{title:"Templates",html:"This button allows you to make scheduling templates.  When in the week view, you can make a template of a given employees schedule.",
buttons:{Prev:-1,Next:1},focus:1,position:{container:"#menu",x:10,y:60,width:300,arrow:"tc"},submit:tutorialSubmit},{title:"Templates",html:"Once a template is created, it will show up in this section.  You can name your templates anything you like.  Clicking on the template will show you the details of the template. You can now drag it onto to calendar to schedule employees based on the template.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#external-events",x:190,y:0,width:300,arrow:"lt"},
submit:tutorialSubmit},{title:"Tutorial",html:"Click the tutorial button if you ever need to see this tutorial again.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#menu",x:120,y:60,width:300,arrow:"tc"},submit:tutorialSubmit},{title:"Add Event",html:"This button allows you to add store related events to the Calendar. You can either add a single event, or a weekly repeating event. Employees can then be scheduled to work the events.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#menu",
x:215,y:60,width:300,arrow:"tc"},submit:tutorialSubmit},{title:"Finalize Schedule",html:"This button allows you to push the schedule out to all employees. Clicking finalize schedule will make the schedule viewable for employees for all days until the last day in your current view.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#menu",x:200,y:60,width:300,arrow:"tr"},submit:function(b,c){if(-1===c)return $.prompt.prevState(),!1;if(1===c)return $.prompt.nextState(),window.setTimeout(function(){$("#finalize").trigger("click");
$("#finalizeConfirmation").addClass("highlighted")},2E3),window.setTimeout(function(){$("#finalizeConfirmation").dialog("close")},6E3),!1}},{title:"Finalize Schedule Example",html:"For example, now we are in the month view. When we click finalize schedule, we will push the schedule out until the last day of the month.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#menu",x:200,y:60,width:300,arrow:"tr"},submit:tutorialSubmit},{title:"Employees",html:"This box contains a list of your employees. Clicking on their name will toggle the visibility of their availability and scheduled days",
buttons:{Prev:-1,Next:1},focus:1,position:{container:"#employees",x:150,y:0,width:300,arrow:"lt"},submit:tutorialSubmit},{title:"Time Slot",html:"This drop down list will update the time slots shown in the week and day views",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#selectTimeSlot",x:170,y:-10,width:300,arrow:"lt"},submit:tutorialSubmit},{title:"Options",html:"This area shows the options that can be changed at any point to display various information. Click to delete allows for deleting of scheduled events by clicking.",
buttons:{Prev:-1,Next:1},focus:1,position:{container:"#options",x:170,y:0,width:300,arrow:"lt"},submit:tutorialSubmit},{title:"Availability",html:"Availability is color coded. Black indicates that the employee is busy and cannot work that day. Green indicates the employee is free all day, and Blue indicates a custom availability.",position:{container:"#container",x:0,y:0,width:300},buttons:{Prev:-1,Next:1},focus:1,submit:tutorialSubmit},{title:"Menu",html:"Here is your main menu! Pay attention to the Finalize Schedule button. Clicking this button will finalize the schedule for the current month, and make it visible to employees.",
position:{container:"#container",x:-170,y:10,width:300,arrow:"rt"},buttons:{Prev:-1,Next:1},focus:1,submit:tutorialSubmit},{title:"Scheduling",html:"When in the month view, clicking on a day will switch to view that week. You can also manually switch between views using these buttons.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#headerButtons",x:-10,y:-10,width:300,arrow:"rm"},submit:function(b,c){if(-1===c)return $.prompt.prevState(),!1;if(1===c)return $("#calendar").fullCalendar("changeView",
"agendaWeek"),$("#calendar").fullCalendar("addEventSource",url+"index.php/manager/tutorialEvents"),$("#calendar").fullCalendar("gotoDate",new Date("2012","0","1")),$.prompt.nextState(),!1}},{title:"Scheduling Continued",html:"When in the week or day view, employees can be scheduled by simply dragging from the desired start time to the end time. A pop up window will allow for the selection of one or multiple employees for the selected shift.",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#headerButtons",
x:150,y:100,width:300},submit:tutorialSubmit},{title:"Shift Editing",html:"Scheduled events can be shifted and resized by clicking and dragging",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#headerButtons",x:150,y:200,width:300},submit:tutorialSubmit},{title:"Employee Information",html:"Clicking on an employees scheduled shift will show a window with information about their weekly desired hours, current week scheduled hours, and special notes (Try it!)",buttons:{Prev:-1,Next:1},focus:1,position:{container:"#headerButtons",
x:150,y:200,width:300},submit:tutorialSubmit},{title:"The End!",html:"Now you are ready to use the Scheduling Software! If you have any questions, feel free to contact Giancarlo Anemone at ganemone@gmail.com",buttons:{Done:2},focus:1,position:{container:"#container",x:0,y:0,width:300},submit:function(){$("#calendar").fullCalendar("removeEventSource",url+"index.php/manager/tutorialEvents");setTutorial(!1);$("#menu").removeClass("temp");$("#top").removeClass("temp");$("#menu").addClass("menu");$("#top").addClass("top")}}];
$("#tutorial").click(function(){setTutorial(!0);$.prompt(tutorialStates,{close:function(){tutorial=!1;$("#menu").removeClass("menuTemp");$("#top").removeClass("temp");$("#menu").addClass("menu");$("#top").addClass("top")}})});